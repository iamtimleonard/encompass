<header>
  <p>Looking at workspace:</p>
  <h3>{{this.model.name}}</h3>
  <p>Owner:</p>
  <h3>{{this.model.owner.displayName}}</h3>
  <p>Last Updated:</p>
  <h3>{{this.model.lastModifiedDate}}</h3>
</header>
<div class="metrics__container">
  <p>{{#link-to "metrics"}}back{{/link-to}}</p>
  <div class="metrics__container metrics--flex">
    <button {{action "handleToggle" "showCloud"}} class="primary-button">Generate Wordcloud</button>
    <button {{action "handleToggle" "showFolders"}} class="primary-button">folders: {{model.foldersLength}}</button>
    <button {{action "handleToggle" "showComments"}} class="primary-button">comments: {{model.commentsLength}}</button>
    <button {{action "handleToggle" "showResponses"}} class="primary-button">responses: {{model.responsesLength}}</button>
    <button {{action "handleToggle" "showSelections"}} class="primary-button">selections: {{model.selectionsLength}}</button>
    <button {{action "handleToggle" "showSubmissions"}} class="primary-button">submissions: {{model.submissionsLength}}</button>
  </div>
  {{#if showSelections}}
    <p>selections</p>
    <table class="metrics__table">
      <thead>
        <tr>
          <th {{on "click" (fn this.toggleColumn 'displayStudents')}}>
            {{if this.displayStudents "Student"}}
          </th>
          <th {{on "click" (fn this.toggleColumn 'displayAnswers')}}>
            {{if this.displayAnswers "Answer"}}
          </th>
          <th {{on "click" (fn this.toggleColumn 'displayExplanations')}}>
            {{#if this.displayExplanations}}
            Explanation
            <button {{action "toggleShowAll"}}>Show All</button>
            {{/if}}
          </th>
          <th {{on "click" (fn this.toggleColumn 'displaySelectedBy')}}>
            {{if this.displaySelectedBy "Selected By"}}
          </th>
          <th {{on "click" (fn this.toggleColumn 'displaySelectedText')}}>
            {{if this.displaySelectedText "Selected Text"}}
          </th>
          <th {{on "click" (fn this.toggleColumn 'displayFolders')}}>
            {{if this.displayFolders "Folders"}}
          </th>
          <th {{on "click" (fn this.toggleColumn 'displayComments')}}>
            {{if this.displayComments "Comments"}}
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each model.selections as |selection|}}
          <tr>
            <td>{{if displayStudents selection.submission.student}}</td>
            <td>
              {{#if this.displayAnswers}}
                {{if selection.submission.shortAnswer selection.submission.shortAnswer selection.submission.answer.answer}}
              {{/if}}
            </td>
            <td>
              {{#if this.displayExplanations}}
                {{expandable-cell showAll=showAll text=(if selection.submission.longAnswer selection.submission.longAnswer selection.submission.answer.explanation)}}
              {{/if}}
            </td>
            <td>
              {{if this.displaySelectedBy selection.createdBy.username}}
            </td>
            <td>{{if this.displaySelectedText selection.text}}</td>
            <td>
              {{#if this.displayFolders}}
              <ul>
                {{#each selection.folders as |folder|}}
                <li>
                  {{folder.name}}
                </li>
                {{/each}}
              </ul>
              {{/if}}
            </td>
            <td>
              {{#if this.displayComments}}
              <ul>
                {{#each selection.comments as |comment|}}
                  <li>{{comment.text}} - {{comment.createdBy.username}}</li>
                {{/each}}
              </ul>
              {{/if}}
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{/if}}
  {{#if showFolders}}
    <table class="metrics__table">
      <thead>
        <tr>
          <th rowspan="2">
            Label
          </th>
          <th colspan="2">
            Contents
          </th>
        </tr>
        <tr>
          <th>
            Text
          </th>
          <th>
            Student
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each model.folders as |folder|}}
          <tr>
            <td>{{folder.name}}</td>
            <td>
              <ol>
                {{#each folder.cleanSelections as |selection|}}
                  <li>{{selection.text}}</li>
                {{/each}}
              </ol>
            </td>
            <td>
              <ol>
              {{#each folder.cleanSelections as |selection|}}
                <li>{{selection.submission.student}}</li>
              {{/each}}
              </ol>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{/if}}
  {{#if showComments}}
    <table class="metrics__table">
      <thead>
        <tr>
          <th>
            Created By
          </th>
          <th>
            Label
          </th>
          <th>
            Text
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each model.comments as |comment|}}
          <tr>
            <td>{{comment.createdBy.username}}</td>
            <td>{{comment.label}}</td>
            <td>{{comment.text}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{/if}}
  {{#if showResponses}}
    <table class="metrics__table">
      <thead>
        <tr>
          <th>
            Created By
          </th>
          <th>
            Text
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each model.responses as |response|}}
          <tr>
            <td>{{response.createdBy.username}}</td>
            <td>{{{response.text}}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{/if}}
  {{#if showSubmissions}}
    <table class="metrics__table">
      <thead>
        <tr>
          <th>
            Student
          </th>
          <th>
            Answer
          </th>
          <th>
            Explanation
            <button {{action "toggleShowAll"}}>Show All</button>
          </th>
          <th>
            Selections and Comments
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each model.submissions as |submission|}}
          <tr>
            <td>{{#link-to "metrics.submission" submission classNames="metrics__link"}}{{submission.student}}{{/link-to}}</td>
            <td>{{if submission.shortAnswer submission.shortAnswer submission.answer.answer}}</td>
            <td>{{expandable-cell showAll=showAll text=(if submission.longAnswer submission.longAnswer submission.answer.explanation)}}</td>
            <td>
              <ul>
                {{#each submission.selections as |selection|}}
                  <li>{{selection.text}}
                    <ul>
                      {{#each selection.comments as |comment|}}
                        <li><em>{{comment.text}}</em> - {{comment.createdBy.username}}</li>
                      {{/each}}
                    </ul>
                  </li>
                {{/each}}
              </ul>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{/if}}
  <p>{{#link-to "metrics"}}back{{/link-to}}</p>
  <WordcloudContainer @showCloud={{this.showCloud}} @list={{this.list}} />
</div>